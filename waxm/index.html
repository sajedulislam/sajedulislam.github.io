<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="shortcut icon" href="fav.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Exam</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
  }
  .container {
    max-width: 600px;
    margin: auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }
  h2 {
    text-align: center;
    color: #333;
  }
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #666;
  }
  input[type="text"], input[type="number"] {
    width: 100%;
    padding: 10px;
    margin: 5px 0 15px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }
  select {
    width: 100%;
    padding: 10px;
    margin: 5px 0 15px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }
  button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    display: block;
    margin: 20px auto;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #45a049;
  }
  #timer {
    text-align: center;
    font-size: 20px;
    margin-bottom: 20px;
  }
  #timeOverMessage {
    color: red;
    text-align: center;
    font-weight: bold;
  }
</style>
<script disable-devtool-auto src='https://on2b.github.io/file/ddt.js'></script>
</head>

<body>

<div class="container">
  <h2>WhatsApp Online Exam</h2>
  <p align="center">System Developed By: <a href="https://sajedulislam.github.io" target="_blank">Sajedul Islam</a></p>
  <div id="timer">Elapsed Time: 00:00</div>
  <div id="timeOverMessage" style="display: none;">Time limit exceeded! You are not allowed to submit.</div>
  </br>
  
  <form id="examForm">
  
  <div id="startExamSection">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>
    <label for="mobile">Mobile Number:</label>
    <input type="number" id="mobile" name="mobile" required>
	<label for="examCode">Exam Code:</label>
    <input type="text" id="examCode" name="examCode" value="WXT01" readonly>
    <button type="button" id="startBtn">Start Exam</button>
  </div>

 </br>
 
  <div id="hide" style="display: none;">
    <!-- MCQ questions -->
    <div id="questions"></div>
    <!-- Hidden button to show answers -->
    <button type="submit" id="submitBtn">Submit</button>
    <button type="button" id="showAnswers" style="display: none;">Show Answers</button>
 </div>
	
  </form>
  
</div>

<script>

  var questions = [
    {
      question: "Which access control is more effective at protecting a door against unauthorized access?",
      options: ["", "A. Fences", "B. Turnstiles", "C. Barriers", "D. Locks"],
      correctAnswer: "D"
    },
    {
      question: "Which type of attack PRIMARILY aims to make a resource inaccessible to its intended users?",
      options: ["", "A. Phishing", "B. Denial of Service", "C. Trojans", "D. Cross-Site Scripting"],
      correctAnswer: "B"
    },
    {
      question: "Which devices have the PRIMARY objective of collecting and analyzing security events?",
      options: ["", "A. Firewalls", "B. Hubs", "C. Routers", "D. SIEM"],
      correctAnswer: "D"
    },
    {
      question: "Which access control model specifies access to an object based on the subject's role in the organization?",
      options: ["", "A. RBAC", "B. MAC", "C. ABAC", "D. DAC"],
      correctAnswer: "A"
    },
    {
      question: "When a company hires an insurance company to mitigate risk, which risk management technique is being applied?",
      options: ["", "A. Risk transfer", "B. Risk avoidance", "C. Risk mitigation", "D. Risk tolerance"],
      correctAnswer: "A"
    },
  ];

  var questionsContainer = document.getElementById("questions");

  // Function to create MCQ elements
  function createMCQElement(questionObj, index) {
    var div = document.createElement("div");
    var label = document.createElement("label");
    label.textContent = (index + 1) + ". " + questionObj.question;
    div.appendChild(label);

    var select = document.createElement("select");
    select.name = questionObj.question;
    questionObj.options.forEach(function(option, optionIndex) {
      var optionElement = document.createElement("option");
      optionElement.value = optionIndex === 0 ? "" : String.fromCharCode(64 + optionIndex); // Convert index to option letter
      optionElement.textContent = option;
      select.appendChild(optionElement);
    });
    select.addEventListener("change", function() {
      select.disabled = true; // Disable the dropdown after selection
    });
    div.appendChild(select);
    questionsContainer.appendChild(div);
  }

  // Create MCQ elements from JSON
  questions.forEach(function(question, index) {
    createMCQElement(question, index);
  });

  // Stopwatch
  var startTime;
  var timeLimit = 0.25 * 60 * 1000; // 0.25 minutes in milliseconds
  var timerInterval;

  function updateTimer() {
    var currentTime = Date.now();
    var elapsedTime = currentTime - startTime;
    var minutes = Math.floor(elapsedTime / 60000);
    var seconds = Math.floor((elapsedTime % 60000) / 1000);
    document.getElementById("timer").textContent = "Elapsed Time: " + padNumber(minutes) + ":" + padNumber(seconds);
  }

  function padNumber(num) {
    return num < 10 ? "0" + num : num;
  }

  document.getElementById("startBtn").onclick = function() {
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("hide").style.display = "block";
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 1000);
  };

  document.getElementById("examForm").onsubmit = function(event) {
    event.preventDefault(); // Prevent form submission

    // Check if time is over
    var currentTime = Date.now();
    var timeDifference = currentTime - startTime;
    if (timeDifference >= timeLimit) {
      clearInterval(timerInterval);
      alert("Time limit exceeded! You are not allowed to submit.");
      return;
    }

    // Get form values
    var name = document.getElementById("name").value;
    var mobile = document.getElementById("mobile").value;
    var examCode = document.getElementById("examCode").value;
    
    // Calculate total obtained marks
    var totalMarks = 0;
    questions.forEach(function(question, index) {
      var selectedOption = document.querySelector('select[name="' + question.question + '"]').value;
      if (selectedOption === question.correctAnswer) totalMarks += 1;
    });

    // Calculate time required
    var timeRequired = Math.floor(timeDifference / 1000 / 60) + ":" + padNumber(Math.floor((timeDifference / 1000) % 60));
    
    // Generate WhatsApp code and encrypt
    var whatsAppCode = encrypt(name + "_" + mobile + "_" + examCode + generateAnswerString() + "_MO_" + totalMarks + "_T" + timeRequired);
    
    // Send WhatsApp code to the specified number
    var whatsappNumber = "+8801515283462"; // Change this to your WhatsApp number
    var whatsappMessage = whatsAppCode;
    var whatsappLink = "https://api.whatsapp.com/send?phone=" + whatsappNumber + "&text=" + encodeURIComponent(whatsappMessage);
    window.open(whatsappLink);
  };

  // Show correct answers when button clicked
  document.getElementById("showAnswers").onclick = function() {
    var correctAnswers = questions.map(function(question, index) {
      return (index + 1) + ". " + question.correctAnswer;
    });
    alert("Correct Answers:\n" + correctAnswers.join(", "));
  };

  // Unicode-based encryption function
  function encrypt(text) {
    var result = "";
    for (var i = 0; i < text.length; i++) {
      var charCode = text.charCodeAt(i);
      // Shift the character code by a fixed number (e.g., 3) and convert it back to a character
      var encryptedCharCode = charCode + 5;
      result += String.fromCharCode(encryptedCharCode);
    }
    return result;
  }

  // Generate answer string for WhatsApp code
  function generateAnswerString() {
    var answerString = "_A_";
    questions.forEach(function(question, index) {
      var selectedOption = document.querySelector('select[name="' + question.question + '"]').value;
      answerString += (index + 1) + "-" + selectedOption + ", ";
    });
    return answerString.slice(0, -2); // Remove trailing comma and space
  }
</script>

<script>
  // Function to check if time limit is exceeded in background
  function checkTimeLimitExceeded() {
    var currentTime = Date.now();
    var timeDifference = currentTime - startTime;
    if (timeDifference >= timeLimit) {
      document.getElementById("timeOverMessage").style.display = "block";
      document.getElementById("showAnswers").style.display = "block";
    }
  }

  // Call the function periodically to check if time limit is exceeded
  var backgroundCheckInterval = setInterval(checkTimeLimitExceeded, 1000);
</script>

</body>
</html>
